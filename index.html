<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<title>Calculateur Bac Tunisie</title>
<link href="css/style.css" rel="stylesheet"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/></head>
<body >
<div class="hero">
<div class="overlay">
<div class="content">
<h1>🎓 Calculateur Bac Tunisie</h1>
<p>Sélectionnez votre section pour calculer votre moyenne et score d’orientation</p>
<div class="cards">
<a href="math.html">🧮<span>Math</span></a>
<a href="science.html">🔬<span>Sciences</span></a>
<a href="technique.html">⚙️<span>Technique</span></a>
<a href="eco.html">📊<span>Économie</span></a>
<a href="info.html">💻<span>Informatique</span></a>
<a href="sport.html">🏃‍♂️<span>Sport</span></a>
<a href="lettres.html">📚<span>Lettres</span></a>

</div>
</div>
</div>
</div>
<!-- Bouton flottant -->
<div id="chat-toggle" onclick="toggleChat()">💬</div>

<!-- Boîte de chat masquée au départ -->
<div id="chatbot" style="display:none;">
  <div id="chat-header">🤖 TuniBot</div>
  <div id="chat-messages"></div>
  <div id="chat-input-area">
    <input type="text" id="chat-input" placeholder="Pose ta question..." />
    <button id="send-btn">➤</button>
  </div>
</div>

<script>
function toggleChat() {
  const chat = document.getElementById("chatbot");
  chat.style.display = (chat.style.display === "none" || chat.style.display === "") ? "flex" : "none";
}

let lastRequestTime = 0;
const cooldown = 10000; // 10 secondes
const sendBtn = document.getElementById("send-btn");

sendBtn.addEventListener("click", async function () {
  const now = Date.now();
  if (now - lastRequestTime < cooldown) {
    alert("⏳ Patientez quelques secondes avant une nouvelle question.");
    return;
  }

  const input = document.getElementById("chat-input");
  const messages = document.getElementById("chat-messages");
  const userText = input.value.trim();
  if (!userText) return;

  lastRequestTime = now;
  sendBtn.disabled = true;
  sendBtn.style.opacity = 0.6;

  messages.innerHTML += `<div><strong>Vous :</strong> ${userText}</div>`;
  input.value = "";
  messages.innerHTML += `<div id="loading"><em>TuniBot écrit...</em></div>`;
  messages.scrollTop = messages.scrollHeight;

  try {
    const response = await fetch("https://openai-proxy-5nsb.onrender.com/api/chat", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: userText }]
      })
    });

    const data = await response.json();
    const loading = document.getElementById("loading");
    if (loading) loading.remove();

    const botReply = data.choices?.[0]?.message?.content?.trim() || "❌ Pas de réponse.";
    messages.innerHTML += `<div><strong>TuniBot :</strong> ${botReply}</div>`;
    messages.scrollTop = messages.scrollHeight;

  } catch (err) {
    const loading = document.getElementById("loading");
    if (loading) loading.remove();
    messages.innerHTML += `<div><em>❌ Erreur de connexion au proxy</em></div>`;
  }

  sendBtn.disabled = false;
  sendBtn.style.opacity = 1;
});
</script>





</body>
</html>
